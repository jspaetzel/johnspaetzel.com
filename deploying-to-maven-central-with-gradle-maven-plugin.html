<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Deploying to maven central with gradle maven plugin</title>
  <meta name="description" content="When building new projects I generally want to install the bare minimum and then build. The defaults on Sonatype’s website for deploying to OSSRH with Gradle...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://meh.dev/deploying-to-maven-central-with-gradle-maven-plugin">
  <link rel="alternate" type="application/rss+xml" title="meh.dev" href="https://meh.dev/feed.xml">
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">
      <img src="https://0.gravatar.com/avatar/ccf00de89ec54577fb9fd612358a9808?s=56">
      meh.dev
    </a>
    <nav class="site-nav">
      <a class="page-link" href="/cv">CV</a>
      <a class="page-link" href="/archive">Archive</a>
    </nav>
  </div>
</header>


    <div class="wrapper">
      

<article class="post content-wrapper content-style-green" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Deploying to maven central with gradle maven plugin</h2>
    <div class="post-meta">
        <div class="post-meta-text">
          <div class="post-meta-icon">
            <i class="far fa-calendar"></i>
          </div>
          Posted on 
          <time datetime="2020-04-27T08:00:00+00:00" itemprop="datePublished">
            Apr 27, 2020
          </time>
        </div>
        
        
        
          <div class="post-meta-text">
            <div class="post-meta-icon">
              <i class="far fa-calendar-check"></i>
            </div>
            Edited on 
            <time datetime="2020-04-28T08:00:00+00:00" itemprop="dateModified">
              Apr 28, 2020
            </time>
          </div>
          
        
        
        
        <ul class="tag-list">
          
          <li class="inline"><a class="tag-list-link" href="/tag/CI">CI</a></li>
          
          <li class="inline"><a class="tag-list-link" href="/tag/Gradle">Gradle</a></li>
          
          <li class="inline"><a class="tag-list-link" href="/tag/Java">Java</a></li>
          
          <li class="inline"><a class="tag-list-link" href="/tag/Maven">Maven</a></li>
          
        </ul>
        
    </div>
  </header>
  
  <div class="post-content" itemprop="articleBody">
    <p>When building new projects I generally want to install the bare minimum and then build. The defaults on <a href="https://central.sonatype.org/pages/gradle.html">Sonatype’s website for deploying to OSSRH with Gradle</a> modify the build configuration and causes the build to fail if you don’t have credentials set. Building without credentials can be useful for projects which have other contributors who may not be involved in the signing or publishing of artifacts. This post shows what should be changed included in your <code class="language-plaintext highlighter-rouge">gradle.build</code> file in order to do both.</p>

<h2 id="errors-encountered">Errors encountered</h2>

<p>The upload task need to be modified to allow builds without any signing credentials to avoid these two errors by just doing less.</p>

<p><code class="language-plaintext highlighter-rouge">Could not get unknown property 'ossrhUsername' for object of type org.gradle.api.publication.maven.internal.deployer.DefaultGroovyMavenDeployer.</code></p>

<p>This error is because the ‘ossrhUsername’ variable is unset.</p>

<p><code class="language-plaintext highlighter-rouge">Cannot perform signing task ':signArchives' because it has no configured signatory</code></p>

<p>And this one is because the username/password is set but empty.</p>

<h2 id="complete-example-buildgradle">Complete Example build.gradle</h2>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre></td><td class="rouge-code"><pre><span class="c1">// Apply Plugins</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'maven'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'signing'</span>

<span class="c1">// Metadata Definition</span>
<span class="n">group</span> <span class="o">=</span> <span class="s2">"com.example.applications"</span>
<span class="n">archivesBaseName</span> <span class="o">=</span> <span class="s2">"example-application"</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">"1.4.7"</span>

<span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">JavaCompile</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">options</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="s1">'UTF-8'</span>
<span class="o">}</span>

<span class="c1">// Create Jar Files</span>
<span class="n">task</span> <span class="nf">javadocJar</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Jar</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="s1">'javadoc'</span>
    <span class="n">from</span> <span class="n">javadoc</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">sourcesJar</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Jar</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="s1">'sources'</span>
    <span class="n">from</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">allSource</span>
<span class="o">}</span>

<span class="n">artifacts</span> <span class="o">{</span>
    <span class="n">archives</span> <span class="n">javadocJar</span><span class="o">,</span> <span class="n">sourcesJar</span>
<span class="o">}</span>

<span class="c1">// Signing and upload</span>
<span class="n">signing</span> <span class="o">{</span>
    <span class="n">required</span> <span class="o">{</span> <span class="n">gradle</span><span class="o">.</span><span class="na">taskGraph</span><span class="o">.</span><span class="na">hasTask</span><span class="o">(</span><span class="s2">"uploadArchives"</span><span class="o">)</span> <span class="o">}</span>
    <span class="n">sign</span> <span class="n">configurations</span><span class="o">.</span><span class="na">archives</span>
<span class="o">}</span>

<span class="n">uploadArchives</span> <span class="o">{</span>
  <span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenDeployer</span> <span class="o">{</span>
      <span class="n">beforeDeployment</span> <span class="o">{</span> <span class="n">MavenDeployment</span> <span class="n">deployment</span> <span class="o">-&gt;</span> <span class="n">signing</span><span class="o">.</span><span class="na">signPom</span><span class="o">(</span><span class="n">deployment</span><span class="o">)</span> <span class="o">}</span>

      <span class="n">repository</span><span class="o">(</span><span class="nl">url:</span> <span class="s2">"https://oss.sonatype.org/service/local/staging/deploy/maven2/"</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">authentication</span><span class="o">(</span><span class="nl">userName:</span> <span class="n">findProperty</span><span class="o">(</span><span class="s1">'ossrhUsername'</span><span class="o">),</span> <span class="nl">password:</span> <span class="n">findProperty</span><span class="o">(</span><span class="s1">'ossrhPassword'</span><span class="o">))</span>
      <span class="o">}</span>

      <span class="n">snapshotRepository</span><span class="o">(</span><span class="nl">url:</span> <span class="s2">"https://oss.sonatype.org/content/repositories/snapshots/"</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">authentication</span><span class="o">(</span><span class="nl">userName:</span> <span class="n">findProperty</span><span class="o">(</span><span class="s1">'ossrhUsername'</span><span class="o">),</span> <span class="nl">password:</span> <span class="n">findProperty</span><span class="o">(</span><span class="s1">'ossrhPassword'</span><span class="o">))</span>
      <span class="o">}</span>

      <span class="n">pom</span><span class="o">.</span><span class="na">project</span> <span class="o">{</span>
        <span class="n">name</span> <span class="s1">'Example Application'</span>
        <span class="n">packaging</span> <span class="s1">'jar'</span>
        <span class="c1">// optionally artifactId can be defined here  </span>
        <span class="n">description</span> <span class="s1">'A application used as an example on how to set up pushing  its components to the Central Repository.'</span>
        <span class="n">url</span> <span class="s1">'http://www.example.com/example-application'</span>

        <span class="n">scm</span> <span class="o">{</span>
          <span class="n">connection</span> <span class="s1">'scm:svn:http://foo.googlecode.com/svn/trunk/'</span>
          <span class="n">developerConnection</span> <span class="s1">'scm:svn:https://foo.googlecode.com/svn/trunk/'</span>
          <span class="n">url</span> <span class="s1">'http://foo.googlecode.com/svn/trunk/'</span>
        <span class="o">}</span>

        <span class="n">licenses</span> <span class="o">{</span>
          <span class="n">license</span> <span class="o">{</span>
            <span class="n">name</span> <span class="s1">'The Apache License, Version 2.0'</span>
            <span class="n">url</span> <span class="s1">'http://www.apache.org/licenses/LICENSE-2.0.txt'</span>
          <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">developers</span> <span class="o">{</span>
          <span class="n">developer</span> <span class="o">{</span>
            <span class="n">id</span> <span class="s1">'jspaetzel'</span>
            <span class="n">name</span> <span class="s1">'John Spaetzel'</span>
            <span class="n">email</span> <span class="s1">'john@example.com'</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Project Dependencies</span>
<span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="configuration">Configuration</h2>

<p>When you are ready to upload you’ll also need the credentials for signing in a <code class="language-plaintext highlighter-rouge">gradle.properties</code> file.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="s">signing.keyId=YourKeyId</span>
<span class="s">signing.password=YourPublicKeyPassword</span>
<span class="s">signing.secretKeyRingFile=PathToYourKeyRingFile</span>

<span class="s">ossrhUsername=your-jira-id</span>
<span class="s">ossrhPassword=your-jira-password</span>
</pre></td></tr></tbody></table></code></pre></div></div>


    

    
    
  </div>

  

  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
    this.page.url = "https://meh.dev/deploying-to-maven-central-with-gradle-maven-plugin";
    this.page.identifier = '/deploying-to-maven-central-with-gradle-maven-plugin';
  };
  (function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://jspaetzel.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view comments</noscript>
  <script id="dsq-count-scr" src="//jspaetzel.disqus.com/count.js" async></script>
</article>


    </div>

    <footer class="footer">
    <div class="copyright">© 2021  <i class="fas fa-heart"></i>  John Spaetzel</div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Josefin Sans', 'Noto Sans', 'Roboto Mono', 'Material Icons']
    }
  });
</script>
<script src="https://kit.fontawesome.com/ea17bff308.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W3G88JG6ZH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W3G88JG6ZH');
</script>

  </body>

</html>

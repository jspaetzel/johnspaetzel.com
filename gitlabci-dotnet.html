<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Building Dotnet with Gitlab CI</title>
  <meta name="description" content="The vast majority of GitLab’s CI examples usually are centered around ruby development though it is an incredibly powerful tool for any language or framework...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://meh.dev/gitlabci-dotnet">
  <link rel="alternate" type="application/rss+xml" title="meh.dev" href="https://meh.dev/feed.xml">
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">
      <img src="https://0.gravatar.com/avatar/ccf00de89ec54577fb9fd612358a9808?s=56">
      meh.dev
    </a>
    <nav class="site-nav">
      <a class="page-link" href="/cv">CV</a>
      <a class="page-link" href="/archive">Archive</a>
    </nav>
  </div>
</header>


    <div class="wrapper">
      

<article class="post content-wrapper content-style-green" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Building Dotnet with Gitlab CI</h2>
    <div class="post-meta">
        <div class="post-meta-text">
          <div class="post-meta-icon">
            <i class="far fa-calendar"></i>
          </div>
          Posted on 
          <time datetime="2016-04-26T05:00:00+00:00" itemprop="datePublished">
            Apr 26, 2016
          </time>
        </div>
        
        
        
        
        
        <ul class="tag-list">
          
          <li class="inline"><a class="tag-list-link" href="/tag/Dotnet">Dotnet</a></li>
          
          <li class="inline"><a class="tag-list-link" href="/tag/CI">CI</a></li>
          
        </ul>
        
    </div>
  </header>
  
  <div class="post-content" itemprop="articleBody">
    <p>The vast majority of GitLab’s CI examples usually are centered around ruby development though it is an incredibly powerful tool for any language or framework.</p>

<p>I’ll briefly demonstrate in this tutorial how to use GitLab.com to build, test, and publish any .NET application or nuget package quickly and easily.
<!--more-->
Requirements:</p>

<ol>
  <li>Any dependencies necessary to run your application locally.</li>
  <li>GitLab.com account.</li>
</ol>

<h2 id="working-with-the-command-line">Working with the command line</h2>
<p>A quick introduction to building asp.net projects with the command line using msbuild, nuget, nunit, and mstest. Anything you can do in the command line you will be able to do as a task with gitlab-ci.</p>

<h4 id="building-from-the-cli">Building from the CLI</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nb">cd </span>your_project_dir
nuget restore
msbuild yoursolution.sln
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="testing-your-build">Testing your build</h4>
<p>I regularly use NUnit &amp; VS Test Tools, but any runner will work.</p>

<p>MSTest aka Visual Studio Test Tools
<code class="language-plaintext highlighter-rouge">mstest /testcontainer:testproject/bin/Debug/testproject.dll</code></p>

<p>NUnit: <code class="language-plaintext highlighter-rouge">nunit-console testproject.csproj</code></p>

<p>Nunit also lets you reference the DLL directly, whereas mstest does not
<code class="language-plaintext highlighter-rouge">nunit-console testproject/bin/Debug/testproject.dll</code></p>

<h4 id="creating--publishing-a-nuget-package">Creating &amp; publishing a nuget package</h4>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>nuget pack <span class="s2">"my-project.csproj"</span> <span class="nt">-IncludeReferencedProjects</span> <span class="nt">-Build</span> <span class="nt">-Properties</span> <span class="nv">Configuration</span><span class="o">=</span>Release <span class="nt">-Version</span> 1.0.0
nuget push <span class="se">\*</span>.nupkg %NugetAPIKey%
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Want to publish to a private nuget server? Tack on: -Source %NugetSource%’</p>

<h4 id="publishing-a-website">Publishing a website</h4>
<p>Using a publishing profile this is really easy</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>msbuild my-project.csproj /p:Configuration<span class="o">=</span>Release /t:ReBuild /p:PublishProfile<span class="o">=</span><span class="s2">"my-profile-name"</span> /p:DeployOnBuild<span class="o">=</span>True /p:password<span class="o">=</span><span class="s2">"MyDeploymentPassword"</span>  /p:VisualStudioVersion<span class="o">=</span>12.0
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="setup-a-gitlab-runner">Setup a gitlab runner</h2>
<p>Find the docs for this on the gitlab website, they’re good!
https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/windows.md</p>

<h2 id="creating-your-ci-config-file">Creating your CI config file</h2>
<p>Once you have a runner working on a machine you can add a config file to a project. This should be named <code class="language-plaintext highlighter-rouge">.gitlab-ci.yml</code> in order to be recognized by gitlab.</p>

<p>Here’s a full example of one that works fine for a simple project that you want to continuously build, test, and deploy.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>

<span class="na">before_script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">nuget</span><span class="nv"> </span><span class="s">restore</span><span class="nv"> </span><span class="s">my-solution.sln'</span>

<span class="na">build</span><span class="pi">:</span>
 <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
 <span class="na">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">msbuild</span><span class="nv"> </span><span class="s">my-solution.sln</span><span class="nv"> </span><span class="s">/t:Clean,ReBuild</span><span class="nv"> </span><span class="s">/p:Configuration=Debug;Platform="Any</span><span class="nv"> </span><span class="s">CPU"'</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">nunit-console</span><span class="nv"> </span><span class="s">my-test-project/my-test-project.csproj'</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">msbuild</span><span class="nv"> </span><span class="s">my-solution.sln</span><span class="nv"> </span><span class="s">/t:ReBuild</span><span class="nv"> </span><span class="s">/p:Configuration=Release;Platform="Any</span><span class="nv"> </span><span class="s">CPU"'</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">nuget</span><span class="nv"> </span><span class="s">pack</span><span class="nv"> </span><span class="s">"my-project/my-project.csproj"</span><span class="nv"> </span><span class="s">-IncludeReferencedProjects</span><span class="nv"> </span><span class="s">-Build</span><span class="nv"> </span><span class="s">-Properties</span><span class="nv"> </span><span class="s">Configuration=Release</span><span class="nv"> </span><span class="s">-Version</span><span class="nv"> </span><span class="s">0.0.1.%CI_BUILD_ID%'</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">nuget</span><span class="nv"> </span><span class="s">push</span><span class="nv"> </span><span class="s">\*.nupkg</span><span class="nv"> </span><span class="s">%NugetAPIKey%</span><span class="nv"> </span><span class="s">-Source</span><span class="nv"> </span><span class="s">%NugetSource%'</span>
 <span class="na">only</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">master</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Most of these are the familiar commands that we went over above, but there’s a couple things to point out.</p>
<ul>
  <li>%CI_BUILD_ID% : Automatic variable for the unique build number</li>
  <li>%NugetAPIKey% : Custom project variable</li>
  <li>%NugetSource% : Custom project variable</li>
</ul>


    

    
    
  </div>

  

  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
    this.page.url = "https://meh.dev/gitlabci-dotnet";
    this.page.identifier = '/gitlabci-dotnet';
  };
  (function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://jspaetzel.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view comments</noscript>
  <script id="dsq-count-scr" src="//jspaetzel.disqus.com/count.js" async></script>
</article>


    </div>

    <footer class="footer">
    <div class="copyright">© 2021  <i class="fas fa-heart"></i>  John Spaetzel</div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Josefin Sans', 'Noto Sans', 'Roboto Mono', 'Material Icons']
    }
  });
</script>
<script src="https://kit.fontawesome.com/ea17bff308.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W3G88JG6ZH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W3G88JG6ZH');
</script>

  </body>

</html>

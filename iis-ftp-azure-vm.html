<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>IIS FTP on Azure VM</title>
  <meta name="description" content="A quick guide on how to configure IIS for FTP on an Azure VM.">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://meh.dev/iis-ftp-azure-vm">
  <link rel="alternate" type="application/rss+xml" title="meh.dev" href="https://meh.dev/feed.xml">
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">
      <img src="https://0.gravatar.com/avatar/ccf00de89ec54577fb9fd612358a9808?s=56">
      meh.dev
    </a>
    <nav class="site-nav">
      <a class="page-link" href="/cv">CV</a>
      <a class="page-link" href="/archive">Archive</a>
    </nav>
  </div>
</header>


    <div class="wrapper">
      

<article class="post content-wrapper content-style-green" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">IIS FTP on Azure VM</h2>
    <div class="post-meta">
        <div class="post-meta-text">
          <div class="post-meta-icon">
            <i class="far fa-calendar"></i>
          </div>
          Posted on 
          <time datetime="2016-06-29T05:00:00+00:00" itemprop="datePublished">
            Jun 29, 2016
          </time>
        </div>
        
        
        
        
        
        <ul class="tag-list">
          
          <li class="inline"><a class="tag-list-link" href="/tag/FTP">FTP</a></li>
          
        </ul>
        
    </div>
  </header>
  
  <div class="post-content" itemprop="articleBody">
    <p>A quick guide on how to configure IIS for FTP on an Azure VM.
<!--more--></p>

<h1 id="azure">Azure</h1>

<p>Once you have a new server created you’ll need to open ports to allow FTP access to the VM. You can do this by creating an endpoint for each port for the server via portal.azure.com, manage.windowsazure.com, or via the azure command line.</p>

<p>Note the IP address of the server for later.</p>

<ul>
  <li>FTP Port: 21</li>
  <li>FTP Passive Data Ports: 20000-20005, I used this range but you could use more or less.</li>
</ul>

<h1 id="install-ftp-service">Install FTP Service</h1>
<p><img src="./assets/iis-ftp-azure/turnwindowsfeaturesonoff.jpg" alt="Turn on or off" />
<img src="./assets/iis-ftp-azure/addfeatures.jpg" alt="Add FTP" /></p>

<h1 id="configuring-iis">Configuring IIS</h1>

<h3 id="firewall-via-iis">Firewall via IIS</h3>
<p><img src="./assets/iis-ftp-azure/firewall.png" alt="Firewall Settings" />
Specify a passive port range, the same range you opened on azure.
Include your firewall Ip, this is to make sure that passive connections route properly. Otherwise you might end up with an error like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>227 Entering Passive Mode <span class="o">(</span>172,19,0,4,78,32<span class="o">)</span><span class="nb">.</span>
Status:	Server sent passive reply with unroutable address. Using server address instead.
</pre></td></tr></tbody></table></code></pre></div></div>

<p><a href="http://grantcurell.com/2013/12/31/failed-to-retrieve-directory-listing-filezilla-connecting-to-iis-behind-nat/">How this works and why, here</a></p>

<h3 id="ftp-user-isolation">FTP User Isolation</h3>
<p>This is the setting I decided to go with, there’s a good explanation of how each of these work in the <a href="https://www.iis.net/configreference/system.applicationhost/sites/site/ftpserver/userisolation">microsoft documentation</a>.</p>

<p><img src="./assets/iis-ftp-azure/isolation.png" alt="Firewall Settings" /></p>

<h1 id="setting-up-the-ftp-site-users-and-directories">Setting up the FTP Site, users, and directories</h1>

<h3 id="ftp-site">FTP Site</h3>
<p>This is per host/name that you want to use. In my case I only needed one of these.
<img src="./assets/iis-ftp-azure/addftpsite.jpg" alt="Add FTP" />
<img src="./assets/iis-ftp-azure/addftp-step1.jpg" alt="Add FTP - 1" />
<img src="./assets/iis-ftp-azure/addftp-step2.jpg" alt="Add FTP - 2" />
<img src="./assets/iis-ftp-azure/addftp-step3.jpg" alt="Add FTP - 3" /></p>

<h3 id="add-virtual-directory">Add Virtual Directory</h3>
<p><img src="./assets/iis-ftp-azure/addvdirectory.jpg" alt="Add Virtual Directory" />
<img src="./assets/iis-ftp-azure/addvdirectory-2.jpg" alt="Add Virtual Directory" /></p>

<h3 id="user-restrict-the-directory">User Restrict the Directory</h3>
<p>By default the new directory will be accessible to any authenticated user, to change this.</p>
<ul>
  <li>Click the directory in the left panel</li>
  <li>Click “FTP Authorization Rules”</li>
  <li>Delete the Allow “All Users” rule</li>
  <li>Add a rule to allow specific users or groups.</li>
</ul>

<h1 id="restart-microsoft-ftp-service">Restart Microsoft FTP Service</h1>
<p>Note: Restarting the service for IIS does not take on all of the settings you applied earlier. <a href="https://forums.iis.net/t/1189918.aspx">thanks to the IIS Forums for pointing this one out</a>
<img src="./assets/iis-ftp-azure/ftpservice.jpg" alt="Add Virtual Directory" /></p>


    

    
    
  </div>

  

  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
    this.page.url = "https://meh.dev/iis-ftp-azure-vm";
    this.page.identifier = '/iis-ftp-azure-vm';
  };
  (function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://jspaetzel.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view comments</noscript>
  <script id="dsq-count-scr" src="//jspaetzel.disqus.com/count.js" async></script>
</article>


    </div>

    <footer class="footer">
    <div class="copyright">© 2021  <i class="fas fa-heart"></i>  John Spaetzel</div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Josefin Sans', 'Noto Sans', 'Roboto Mono', 'Material Icons']
    }
  });
</script>
<script src="https://kit.fontawesome.com/ea17bff308.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W3G88JG6ZH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W3G88JG6ZH');
</script>

  </body>

</html>
